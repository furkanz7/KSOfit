import { Stack } from 'expo-router';
import * as SplashScreen from 'expo-splash-screen';
import { StatusBar } from 'expo-status-bar';
import { useEffect } from 'react';
import { View } from 'react-native';
import { SettingsProvider } from '../providers/SettingsContext';

// Prevent the splash screen from auto-hiding before asset loading is complete.
SplashScreen.preventAutoHideAsync().catch(() => { });

export default function RootLayout() {
    console.log("--- ROOT LAYOUT MOUNTED ---");
    // Skipped explicit Font loading to prevent hang on Android/Expo Go interactions
    // The Ionicons font is built-in to Expo Go or handles itself gracefully usually.
    const loaded = true;
    const error = null;

    useEffect(() => {
        if (error) throw error;
    }, [error]);

    useEffect(() => {
        if (loaded) {
            SplashScreen.hideAsync().catch(() => { });
        }
    }, [loaded]);

    // Safety timeout: If fonts take too long (>3s), hide splash anyway
    useEffect(() => {
        const timer = setTimeout(() => {
            SplashScreen.hideAsync().catch(() => { });
        }, 3000);
        return () => clearTimeout(timer);
    }, []);

    if (!loaded) {
        return null;
    }

    return (
        <SettingsProvider>
            <View style={{ flex: 1, backgroundColor: '#0f172a' }}>
                <StatusBar style="light" />
                <Stack screenOptions={{ headerShown: false, animation: 'fade', contentStyle: { backgroundColor: '#0f172a' } }}>
                    <Stack.Screen name="index" />
                    <Stack.Screen name="(auth)" />
                    <Stack.Screen name="(tabs)" />
                    <Stack.Screen name="flow/workout-setup" />
                    <Stack.Screen name="flow/nutrition-setup" />
                    <Stack.Screen name="tools/bmi-calculator" />
                </Stack>
            </View>
        </SettingsProvider>
    );
}
